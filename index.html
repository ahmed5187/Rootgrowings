<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RootGrowings</title>

  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0b6b2f" />

  <style>
    * { box-sizing: border-box; }
    :root {
      --green:#0b6b2f; --green2:#2e7d4e; --bg:#f6f8f7; --ink:#0b2d18; --muted:#4a7c63;
      --card:#ffffff; --soft:#eaf5ef; --line:#e2eee7;
    }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink); }

    /* Prevent flicker: hide app shell until auth resolves */
    html.auth-wait header,
    html.auth-wait .hero,
    html.auth-wait main,
    html.auth-wait nav { display:none !important; }

    /* Header */
    header {
      position:sticky; top:0; background:var(--bg);
      padding:10px 12px; display:flex; align-items:center; gap:10px;
      border-bottom:1px solid var(--line); z-index:3;
    }
    header .logo { height:28px; width:auto; }
    header .spacer { flex:1; }
    .iconBtn {
      width:36px; height:36px; border-radius:10px; background:#e9f3ed;
      color:var(--green); border:0; display:grid; place-items:center; cursor:pointer;
    }
    .iconBtn svg { width:18px; height:18px; }

    /* Hero */
    .hero { width:100%; max-height:260px; overflow:hidden; border-bottom:1px solid var(--line); }
    .hero img { width:100%; height:auto; display:block; object-fit:cover; }

    /* Main layout */
    main { padding:12px 12px 96px; max-width:980px; margin:0 auto; text-align:center; }
    h1.title { margin:14px 2px 10px; font-size:24px; font-weight:800; color:var(--green); letter-spacing:.3px; }

    .section { margin:16px 0 24px; }
    .section h3 {
      margin:10px 4px; font-size:15px; color:#4a7c63; font-weight:800;
      display:flex; align-items:center; gap:8px; justify-content:center;
    }
    .roomIcon { width:18px; height:18px; display:inline-grid; place-items:center; background:var(--soft); border-radius:6px; font-size:12px; }
    .group { background:var(--soft); border-radius:16px; padding:12px; }
    .row { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:14px; place-items:center; }
    .card {
      width:100%; max-width:260px; background:var(--card); border-radius:16px; padding:10px;
      box-shadow:0 2px 10px rgba(0,0,0,.05); display:grid; gap:8px; align-content:start;
      position:relative; text-align:center; cursor:pointer;
    }
    .photoWrap { position:relative; }
    .photo { width:100%; aspect-ratio:1/1; border-radius:12px; background:#e8efe9 center/cover no-repeat; }
    .ring {
      position:absolute; top:8px; left:8px; width:42px; height:42px; border-radius:50%;
      background:conic-gradient(var(--green2) var(--pct), #e5ece7 0);
      display:grid; place-items:center; font-size:11px; font-weight:700; color:var(--green);
    }
    .ring span { background:#fff; width:30px; height:30px; border-radius:50%; display:grid; place-items:center; }
    .gear { position:absolute; top:8px; right:8px; width:28px; height:28px; border-radius:50%; border:0; background:#ffffffcc; display:grid; place-items:center; cursor:pointer; }
    .gear svg { width:16px; height:16px; color:#4a7c63; }
    .name { font-weight:800; font-size:14px; }
    .nick { color:#46795b; font-size:12px; }
    .meta { font-size:11px; color:#355747; }
    .actions { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .btn { border:0; padding:9px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
    .btn.primary { background:var(--green); color:#fff; }
    .btn.ghost   { background:#eef4f0; color:var(--ink); }

    .empty { text-align:center; color:#507a65; padding:40px 10px; }

    .page { display:none; }
    .page.active { display:block; }

    .settings { display:grid; gap:12px; text-align:center; }
    .btnRow { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .row2 { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    input, select { width:100%; padding:10px; border:1px solid #cfe0d6; border-radius:8px; }
    label { font-size:12px; color:#355747; }

    dialog { border:0; border-radius:14px; width:min(560px,92vw); }
    dialog::backdrop { background:rgba(0,0,0,.2); }
    menu { display:flex; justify-content:center; gap:8px; }

    .iconGrid { display:grid; grid-template-columns:repeat(8,1fr); gap:8px; }
    .iconPick { border:1px solid #cfe0d6; border-radius:8px; padding:6px; cursor:pointer; background:#fff; }
    .iconPick.selected { outline:2px solid var(--green); }

    /* Bottom nav */
    nav {
      position:fixed; left:0; right:0; bottom:0; background:#fff;
      border-top:1px solid var(--line); display:grid; grid-template-columns:repeat(4,1fr);
      padding:8px 10px; z-index:5;
    }
    nav button { background:transparent; border:0; padding:8px; font-size:12px; color:#4a7c63; display:grid; place-items:center; gap:4px; cursor:pointer; }
    .navIcon { width:22px; height:22px; }
    .active { color:var(--green); font-weight:800; }

    /* Toast */
    #toastDialog .toastBox { display:grid; place-items:center; gap:10px; text-align:center; padding:18px; }
    .toastIcon { width:34px; height:34px; border-radius:999px; background:#e6f4ea; color:var(--green); display:grid; place-items:center; }
    .toastMsg { color:#264d36; font-weight:700; }

    /* Profile (mobile-friendly) */
    .avatar { width:72px; height:72px; border-radius:50%; object-fit:cover; border:3px solid #e6f4ea; }
    .muted { color:var(--muted); font-size:12px; }
    .fileRow { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .fileHide { position:absolute; left:-9999px; }
    .fileBtn { padding:10px 12px; border-radius:10px; border:0; background:#eef4f0; cursor:pointer; font-weight:700; }
    .fileName { font-size:12px; color:#355747; }

    /* Plant details modal */
    .detailsImg { width:100%; aspect-ratio:16/9; border-radius:12px; background:#e8efe9 center/cover no-repeat; }
    .history { width:100%; border-collapse:collapse; margin-top:10px; }
    .history th, .history td { border-bottom:1px solid #e8efe9; padding:6px 8px; font-size:12px; text-align:left; }
    .history th { color:#355747; font-weight:700; }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <img class="logo" src="assets/RGlogo.png" alt="RootGrowings" />
    <div class="spacer"></div>
    <button id="plusBtn" class="iconBtn" title="Add">
      <svg viewBox="0 0 24 24"><path d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z" fill="currentColor"/></svg>
    </button>
    <button id="profileBtn" class="iconBtn" title="Profile">
      <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4 0-8 2-8 5v1h16v-1c0-3-4-5-8-5Z" fill="currentColor"/></svg>
    </button>
  </header>

  <!-- Hero -->
  <div class="hero"><img src="assets/hero.jpg" alt=""></div>

  <!-- Main -->
  <main>
    <!-- Home -->
    <h1 class="title" id="homeTitle">My Plants</h1>
    <section id="homePage" class="page active">
      <div id="homeContent"></div>
      <div id="homeEmpty" class="empty" hidden>
        Add your first plant from the plus button then come back here.
      </div>
    </section>

    <!-- Settings -->
    <h1 class="title" id="settingsTitle" style="display:none">My Settings</h1>
    <section id="settingsPage" class="page">
      <div class="settings">
        <h3>Rooms</h3>
        <div class="btnRow">
          <button class="btn primary" id="btnAddRoom">Add a Room</button>
          <button class="btn ghost" id="btnEditRoom">Edit a Room</button>
          <button class="btn ghost" id="btnRemoveRoom">Remove a Room</button>
        </div>

        <h3>Plants</h3>
        <div class="btnRow">
          <button class="btn primary" id="btnAddPlant">Add a Plant</button>
          <button class="btn ghost" id="btnEditPlant">Edit a Plant</button>
          <button class="btn ghost" id="btnRemovePlant">Remove a Plant</button>
        </div>
      </div>
    </section>

    <!-- Insights -->
    <h1 class="title" id="insightsTitle" style="display:none">Insights</h1>
    <section id="insightsPage" class="page">
      <div class="chartCard">
        <div class="chartTitle">Waterings — last 14 days</div>
        <div class="chartWrap"><svg id="chart14Water" class="chart" viewBox="0 0 560 160"></svg></div>
      </div>
      <div class="chartCard">
        <div class="chartTitle">Fertilizer — last 14 days</div>
        <div class="chartWrap"><svg id="chart14Fert" class="chart" viewBox="0 0 560 160"></svg></div>
      </div>
      <div class="chartCard">
        <div class="chartTitle">Waterings per plant</div>
        <div class="chartWrap"><svg id="chartByPlant" class="chart" viewBox="0 0 560 160"></svg></div>
      </div>
      <div class="chartCard">
        <div class="chartTitle">Waterings per room</div>
        <div class="chartWrap"><svg id="chartByRoomWater" class="chart" viewBox="0 0 560 160"></svg></div>
      </div>
      <div class="chartCard">
        <div class="chartTitle">Fertilizer per room</div>
        <div class="chartWrap"><svg id="chartByRoomFert" class="chart" viewBox="0 0 560 160"></svg></div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav>
    <button id="navSettings">
      <svg class="navIcon" viewBox="0 0 24 24"><path d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm9.4 4a7.4 7.4 0 0 0-.1-1l2-1.6-2-3.5-2.4 1a7.5 7.5 0 0 0-1.7-1l-.4-2.6H9.2l-.4 2.6c-.6.2-1.2.5-1.7 1l-2.4-1-2 3.5 2 1.6a7.4 7.4 0 0 0-.1 1c0 .3 0 .7.1 1l-2 1.6 2 3.5 2.4-1c.5.4 1.1.7 1.7 1l.4 2.6h5.6l.4-2.6c.6-.2 1.2-.5 1.7-1l2.4 1 2-3.5-2-1.6c.1-.3.1-.6.1-1Z" fill="currentColor"/></svg>
      <span>Settings</span>
    </button>
    <button id="navHome" class="active">
      <svg class="navIcon" viewBox="0 0 24 24"><path d="M12 3 2 11h3v10h6V15h2v6h6V11h3L12 3Z" fill="currentColor"/></svg>
      <span>Home</span>
    </button>
    <button id="navInsights">
      <svg class="navIcon" viewBox="0 0 24 24"><path d="M3 13h4v8H3v-8Zm7-6h4v14h-4V7Zm7-4h4v18h-4V3Z" fill="currentColor"/></svg>
      <span>Insights</span>
    </button>
    <button id="navChat">
      <svg class="navIcon" viewBox="0 0 24 24"><path d="M4 4h16v10H7l-3 3V4Z" fill="currentColor"/></svg>
      <span>Chat</span>
    </button>
  </nav>

  <!-- Toast -->
  <dialog id="toastDialog">
    <div class="toastBox">
      <div class="toastIcon">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M9.5 16.2 5.3 12l1.4-1.4 2.8 2.8 7.8-7.8L18.7 7z"/></svg>
      </div>
      <div id="toastMsg" class="toastMsg">Saved</div>
      <menu><button id="toastOk" class="btn primary">OK</button></menu>
    </div>
  </dialog>

  <!-- Ask Notifications -->
  <dialog id="notifyDialog">
    <form method="dialog" style="padding:16px; text-align:center">
      <h3 style="margin:0 0 8px; color:#14532d">Enable Notifications</h3>
      <p class="muted">We’ll remind you exactly when it’s time to water or fertilize.</p>
      <menu style="margin-top:10px">
        <button id="notifyLater" type="button" class="btn ghost">Later</button>
        <button id="notifyAllow" type="button" class="btn primary">Allow</button>
      </menu>
    </form>
  </dialog>

  <!-- Profile -->
  <dialog id="profileDialog">
    <form id="profileForm" method="dialog" style="padding:18px 18px 10px;">
      <div style="display:grid; place-items:center; gap:8px; text-align:center">
        <img id="profileAvatar" class="avatar" src="assets/RGicon.jpg" alt="">
        <div id="profileName" style="font-weight:800">User</div>
        <div id="profileEmail" class="muted">email@example.com</div>
      </div>

      <div style="margin-top:12px" class="row2">
        <div>
          <label>Display name</label>
          <input id="displayNameInput" placeholder="Your name" />
        </div>
        <div>
          <label>Upload new photo (optional)</label>
          <div class="fileRow">
            <input id="photoFileInput" class="fileHide" type="file" accept="image/*" />
            <button id="choosePhotoBtn" type="button" class="fileBtn">Choose photo</button>
            <span id="fileName" class="fileName">No photo chosen</span>
          </div>
        </div>
      </div>

      <menu style="margin-top:12px">
        <button id="signOutBtn" type="button" class="btn ghost" style="margin-right:auto">Sign Out</button>
        <button id="closeProfile" type="button" class="btn ghost">Close</button>
        <button type="submit" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- Plant details (click a card) -->
  <dialog id="plantDetailsDialog">
    <div style="padding:16px">
      <div id="detailsImage" class="detailsImg"></div>
      <h3 id="detailsTitle" style="margin:12px 0 6px">Plant</h3>
      <div id="detailsMeta" class="muted" style="margin-bottom:8px">Room • Next water • Next fertilizer</div>

      <table id="detailsHistory" class="history">
        <thead>
          <tr><th>Recent</th><th>Date &amp; time</th></tr>
        </thead>
        <tbody>
          <!-- JS will render last 3 water + last 3 fertilizer rows here -->
        </tbody>
      </table>

      <menu style="margin-top:10px">
        <button id="detailsDeleteBtn" type="button" class="btn ghost" style="margin-right:auto">Delete</button>
        <button id="detailsCloseBtn"  type="button" class="btn ghost">Close</button>
        <button id="detailsEditBtn"   type="button" class="btn primary">Edit</button>
      </menu>
    </div>
  </dialog>

  <!-- Plant & Room dialogs -->
  <dialog id="plantDialog">
    <form id="plantForm" method="dialog">
      <h3 id="plantDialogTitle">Add plant</h3>

      <div class="row2">
        <div><label>Name</label><input name="name" required placeholder="Monstera" /></div>
        <div><label>Nickname</label><input name="nickname" placeholder="Mo" /></div>
      </div>

      <label>Photo</label>
      <input name="photo" type="file" accept="image/*" />

      <div class="row2">
        <div><label>Plant type</label><input name="plantType" placeholder="Monstera deliciosa" /></div>
        <div><label>Room</label><select name="location" id="roomSelect"></select></div>
      </div>

      <div class="row2">
        <div><label>Pot size cm</label><input name="potSize" type="number" min="5" max="40" step="1" value="15" /></div>
        <div>
          <label>Light level</label>
          <select name="lightLevel">
            <option value="medium">Medium</option>
            <option value="bright">Bright</option>
            <option value="low">Low</option>
          </select>
        </div>
      </div>

      <!-- Left: water schedule → interval → time | Right: fertilizer schedule (days) → time -->
      <div class="row2">
        <div>
          <label>Water schedule</label>
          <select name="scheduleMode">
            <option value="suggested">Suggested</option>
            <option value="custom">Custom</option>
          </select>
          <label style="margin-top:8px; display:block">Custom interval days</label>
          <input name="customIntervalDays" type="number" min="2" max="60" value="10" />
          <label style="margin-top:8px; display:block">Water time (local)</label>
          <input name="preferredWaterTime" type="time" value="09:00" />
        </div>
        <div>
          <label>Fertilizer interval days</label>
          <input name="fertilizerIntervalDays" type="number" min="7" max="180" value="30" />
          <label style="margin-top:8px; display:block">Fertilizer time (local)</label>
          <input name="preferredFertilizeTime" type="time" value="09:00" />
        </div>
      </div>

      <menu>
        <button id="deletePlantBtn" type="button" class="btn ghost" style="margin-right:auto; display:none">Delete</button>
        <button id="cancelBtn"      type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- Rooms -->
  <dialog id="addRoomDialog">
    <form id="addRoomForm" method="dialog">
      <h3>Add a Room</h3>
      <label>Room name</label>
      <input name="roomName" required placeholder="Bedroom" />
      <label>Choose icon</label>
      <div id="iconGrid" class="iconGrid"></div>
      <menu>
        <button id="addRoomCancel" type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="editRoomDialog">
    <form id="editRoomForm" method="dialog">
      <h3>Edit a Room</h3>
      <label>Select room</label>
      <select name="roomToEdit" id="roomEditSelect"></select>
      <label>New name</label>
      <input name="newRoomName" placeholder="New name" />
      <label>Choose new icon</label>
      <div id="iconGridEdit" class="iconGrid"></div>
      <menu>
        <button id="editRoomCancel" type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="removeRoomDialog">
    <form id="removeRoomForm" method="dialog">
      <h3>Remove a Room</h3>
      <label>Select room to remove</label>
      <select name="roomToRemove" id="roomRemoveSelect"></select>
      <p class="meta">Plants in the removed room will move to Unassigned.</p>
      <menu>
        <button id="removeRoomCancel" type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Remove</button>
      </menu>
    </form>
  </dialog>

  <!-- Edit/remove by picker (optional) -->
  <dialog id="editPlantChooser">
    <form id="editPlantChooserForm" method="dialog">
      <h3>Edit a Plant</h3>
      <label>Select plant</label>
      <select name="plantToEdit" id="plantEditSelect"></select>
      <menu>
        <button id="editPlantCancel" type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Edit</button>
      </menu>
    </form>
  </dialog>

  <dialog id="removePlantDialog">
    <form id="removePlantForm" method="dialog">
      <h3>Remove a Plant</h3>
      <label>Select plant</label>
      <select name="plantToRemove" id="plantRemoveSelect"></select>
      <menu>
        <button id="removePlantCancel" type="button" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Remove</button>
      </menu>
    </form>
  </dialog>

  <!-- App script -->
  <script type="module" src="./app_cloud.js?v=14"></script>
</body>
</html>